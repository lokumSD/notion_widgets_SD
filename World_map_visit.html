<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Interactive Polygon Map</title>
  <!-- Styles -->
  <style>
    #chartdiv {
      width: 100%;
      height: 500px;
    }
  </style>

  <!-- Resources -->
  <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
</head>

<body>
  <div id="chartdiv"></div>
  <script>
    am5.ready(function() {
      var root = am5.Root.new("chartdiv");
      root.setThemes([am5themes_Animated.new(root)]);
      var chart = root.container.children.push(am5map.MapChart.new(root, {
        panX: "rotateX",
        panY: "translateY",
        projection: am5map.geoNaturalEarth1()
      }));
      var polygonSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {
        geoJSON: am5geodata_worldLow,
        exclude: ["AQ"]
      }));
      chart.chartContainer.set("background", am5.Rectangle.new(root, {
        fill: am5.color(0x191919),
        fillOpacity: 1.0
      }));
      var activeColor = am5.color("#B9CCB1");
      var defaultColor = am5.color("#FFD6E6");

      polygonSeries.mapPolygons.template.setAll({
        tooltipText: "{name}",
        interactive: true,
        fill: defaultColor,
      });
      polygonSeries.mapPolygons.template.states.create("hover", {
        fill: am5.color("#DEB4C6")
      });

      // Function to handle when a country is clicked
      function handleCountryClick(event) {
        var polygon = event.target;
        var countryId = polygon.dataItem.dataContext.id;
        var isActive = localStorage.getItem("active-country-" + countryId) === 'true';
        polygon.set("fill", isActive ? defaultColor : activeColor);
        localStorage.setItem("active-country-" + countryId, !isActive);
        console.log("Country clicked:", countryId, "isActive:", !isActive);
      }

      // Add a click event listener to handle country clicks
      polygonSeries.mapPolygons.template.events.on("click", handleCountryClick);

      // Retrieve the active states from localStorage and apply them
      polygonSeries.events.on("datavalidated", function() {
        polygonSeries.mapPolygons.each(function(polygon) {
          var countryId = polygon.dataItem.dataContext.id;
          var isActive = localStorage.getItem("active-country-" + countryId) === 'true';
          polygon.set("fill", isActive ? activeColor : defaultColor);
          console.log("Loaded active state for country ID", countryId, "isActive:", isActive);
        });
      });

      // ... (the rest of your code for setting up the map)
    });
  </script>
</body>

</html>
